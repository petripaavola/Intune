# BlackLotus CVE-2023-24932 mitigation check 1/3
# Check if Windows UEFI CA 2023 certificate is installed to UEFI database
#
# Petri.Paavola@yodamiitti.fi
# Microsoft MVP - Windows and Devices
# 24.5.2024
#
# Read Microsoft mitigation instructions from
# https://support.microsoft.com/en-au/topic/kb5025885-how-to-manage-the-windows-boot-manager-revocations-for-secure-boot-changes-associated-with-cve-2023-24932-41a975df-beb2-40c1-99a3-b3ff139f832d


# Check if Windows UEFI CA 2023 certificate is installed in UEFI database
$NewUEFICertificateInstalled = [System.Text.Encoding]::ASCII.GetString((Get-SecureBootUEFI db).bytes) -match 'Windows UEFI CA 2023'

if($NewUEFICertificateInstalled) {
	# Windows UEFI CA 2023 certificate is installed to UEFI database
	
	Write-Host "Windows UEFI CA 2023 certificate is installed to UEFI database"
	Exit 0

} else {
	# Windows UEFI CA 2023 certificate is NOT installed to UEFI database

	Write-Host "Windows UEFI CA 2023 certificate is NOT installed to UEFI database"
	Exit 1
}
